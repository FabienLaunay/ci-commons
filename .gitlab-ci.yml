stages:
  - generate-config
  - lint

GenerateGitlintConfig:
  stage: generate-config
  script:
    - echo "TEST"
  artifacts:
    paths:
      - gitlint.cfg

LintGitCommitMessages:
  stage: lint
  only:
    - main
  dependencies:
    - GenerateGitlintConfig
  image:
    name: python:3.9-slim
    entrypoint: [""]
  script:
    - apt-get update && apt-get install -y curl git
    - pip install gitlint
    - |      
      echo "Downloading gitlint.cfg from the ci-commons project..."
      curl --output gitlint1.cfg ${CI_API_V4_URL}/projects/fabien.launay.public%2Fci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig
      echo "gitlint1.cfg:"
      cat gitlint1.cfg
      curl --output gitlint2.cfg "${CI_API_V4_URL}/projects/fabien.launay.public%2Fci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig"
      echo "gitlint2.cfg:"
      cat gitlint2.cfg
      curl --output gitlint3.cfg https://gitlab.com/api/v4/projects/fabien.launay.public%2Fci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig
      echo "gitlint3.cfg:"
      cat gitlint3.cfg
      curl --output gitlint4.cfg "https://gitlab.com/api/v4/projects/fabien.launay.public%2Fci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig"
      echo "gitlint4.cfg:"
      cat gitlint4.cfg
      curl --output gitlint5.cfg ${CI_API_V4_URL}/projects/fabien.launay.public/ci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig
      echo "gitlint5.cfg:"
      cat gitlint5.cfg
      curl --output gitlint6.cfg "${CI_API_V4_URL}/projects/fabien.launay.public/ci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig"
      echo "gitlint6.cfg:"
      cat gitlint6.cfg
      curl --output gitlint7.cfg https://gitlab.com/api/v4/projects/fabien.launay.public/ci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig
      echo "gitlint7.cfg:"
      cat gitlint7.cfg
      curl --output gitlint8.cfg "https://gitlab.com/api/v4/projects/fabien.launay.public/ci-commons/jobs/artifacts/main/raw/gitlint.cfg?job=GenerateGitlintConfig"
      echo "gitlint8.cfg:"
      cat gitlint8.cfg
      curl --output gitlint9.cfg "https://gitlab.com/fabien.launay.public/ci-commons/-/raw/main/gitlint.cfg"
      echo "gitlint9.cfg:"
      cat gitlint9.cfg
      curl --output gitlint10.cfg "https://gitlab.com/fabien.launay.public/ci-commons/-/raw/main/gitlint.cfg?inline=false"
      echo "gitlint10.cfg:"
      cat gitlint10.cfg      
      echo ""
      ls -l
      echo ""
      echo "gitlint.cfg:"
      cat gitlint.cfg
      echo ""
    - gitlint --config gitlint.cfg