stages:
  - lint

LintGitCommitMessages:
  stage: lint
  only:
    - main
  image:
    name: python:3.9-slim
    entrypoint: [""]
  artifacts:
    paths:
      - cfg/gitlint/gitlint.cfg
  script:
    - apt-get update && apt-get install -y curl git
    - pip install gitlint
    - |
      if [ ! -f cfg/gitlint/gitlint.cfg ]; then
        mkdir -p cfg/gitlint
        echo "Downloading gitlint.cfg from the ci-commons project..."
        echo ${CI_API_V4_URL}
        echo curl --output cfg/gitlint/gitlint.cfg ${CI_API_V4_URL}/projects/fabien.launay.public%2Fci-commons/jobs/artifacts/main/raw/cfg/gitlint/gitlint.cfg?job=LintGitCommitMessages
        curl --output cfg/gitlint/gitlint.cfg ${CI_API_V4_URL}/projects/fabien.launay.public%2Fci-commons/jobs/artifacts/main/raw/cfg/gitlint/gitlint.cfg?job=LintGitCommitMessages
      fi
    - gitlint --config cfg/gitlint/gitlint.cfg
